<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the parse method from the MultipartParser class, for the Dart programming language.">
  <title>parse method - MultipartParser class - jetleaf_web library - Dart API</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="../../static-assets/github.css?v1">
  <link rel="stylesheet" href="../../static-assets/styles.css?v1">
  <link rel="icon" href="../../static-assets/favicon.png?v1">
  
</head>

<body data-base-href="../../" data-using-base-href="false" class="light-theme">
<div id="overlay-under-drawer"></div>
<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="../../index.html">jetleaf_web</a></li>
    <li><a href="../../jetleaf_web/">jetleaf_web.dart</a></li>
    <li><a href="../../jetleaf_web/MultipartParser-class.html">MultipartParser</a></li>
    <li class="self-crumb">parse method</li>
  </ol>
  <div class="self-name">parse</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <button class="toggle" id="theme-button" title="Toggle between light and dark mode" aria-label="Light and dark mode toggle">
    <span id="dark-theme-button" class="material-symbols-outlined" aria-hidden="true">
      dark_mode
    </span>
    <span id="light-theme-button" class="material-symbols-outlined" aria-hidden="true">
      light_mode
    </span>
  </button>
</header>
<main>
<div
    id="dartdoc-main-content"
    class="main-content"
    data-above-sidebar="jetleaf_web&#47;MultipartParser-class-sidebar.html"
    data-below-sidebar="">
    <div>
<h1><span class="kind-method">parse</span> method 
</h1></div>

    <section class="multi-line-signature">
      
  <div>
    <ol class="annotation-list">
        <li>@<a href="https://pub.dev/documentation/meta/1.17.0/meta/protected-constant.html">protected</a></li>
    </ol>
  </div>
<span class="returntype"><a href="https://api.dart.dev/stable/3.9.2/dart-core/Future-class.html">Future</a><span class="signature">&lt;<wbr><span class="type-parameter"><a href="https://api.dart.dev/stable/3.9.2/dart-core/List-class.html">List</a><span class="signature">&lt;<wbr><span class="type-parameter"><a href="../../jetleaf_web/Part-class.html">Part</a></span>&gt;</span></span>&gt;</span></span>
<span class="name ">parse</span>(<wbr><ol class="parameter-list"> <li><span class="parameter" id="parse-param-inputStream"><span class="type-annotation"><a href="https://pub.dev/documentation/jetleaf_lang/1.0.1/lang/InputStream-class.html">InputStream</a></span> <span class="parameter-name">inputStream</span>, </span></li>
<li><span class="parameter" id="parse-param-boundary"><span class="type-annotation"><a href="https://api.dart.dev/stable/3.9.2/dart-core/String-class.html">String</a></span> <span class="parameter-name">boundary</span>, </span></li>
<li><span class="parameter" id="parse-param-charset"><span class="type-annotation"><a href="https://api.dart.dev/stable/3.9.2/dart-core/String-class.html">String</a></span> <span class="parameter-name">charset</span>, [</span></li>
<li><span class="parameter" id="parse-param-contentLength"><span class="type-annotation"><a href="https://api.dart.dev/stable/3.9.2/dart-core/int-class.html">int</a>?</span> <span class="parameter-name">contentLength</span>, </span></li>
</ol>])

      

    </section>
    
<section class="desc markdown">
  <p>Parses a multipart HTTP request body into individual <a href="../../jetleaf_web/Part-class.html">Part</a> instances.</p>
<p>This method reads the <code>inputStream</code> fully, separates it by the given
<code>boundary</code>, decodes headers using the specified <code>charset</code>, and constructs
a list of <a href="../../jetleaf_web/Part-class.html">Part</a> objects representing each section of the multipart data.</p>
<h3 id="parameters">Parameters</h3>
<ul>
<li><code>inputStream</code>: The raw input stream of the HTTP request body.</li>
<li><code>boundary</code>: The multipart boundary string used to separate parts.</li>
<li><code>charset</code>: The character set used to decode headers and text fields.</li>
<li><code>contentLength</code>: The total content length in bytes of the request body.
If provided and greater than 0, the parser will read exactly this many bytes
instead of waiting for EOF, improving performance for streams that don't
signal end-of-stream promptly.</li>
</ul>
<h3 id="returns">Returns</h3>
<p>A <a href="https://api.dart.dev/stable/3.9.2/dart-core/Future-class.html">Future</a> that completes with a list of <a href="../../jetleaf_web/Part-class.html">Part</a> objects extracted from
the multipart body.</p>
<h3 id="behavior">Behavior</h3>
<ol>
<li>Reads the entire input stream into memory (beware large uploads).</li>
<li>Searches for boundaries matching the pattern <code>--&lt;boundary&gt;</code>.</li>
<li>Parses headers for each part (using CRLFCRLF as the separator).</li>
<li>Extracts the part's byte content and trims trailing CRLF if present.</li>
<li>Constructs <a href="../../jetleaf_web/IoPart-class.html">IoPart</a> instances using headers, data, and the
configured <a href="../../jetleaf_web/EncodingDecoder-class.html">EncodingDecoder</a>.</li>
<li>Stops parsing when the end boundary <code>--&lt;boundary&gt;--</code> is encountered.</li>
</ol>
<h3 id="exceptions">Exceptions</h3>
<ul>
<li>Throws <a href="../../jetleaf_web/MultipartParseException-class.html">MultipartParseException</a> if no boundary is found or if parsing fails.</li>
</ul>
<h3 id="example">Example</h3>
<pre class="language-dart"><code class="language-dart">final parts = await parse(request.getBody(), boundary, 'utf-8');
for (final part in parts) {
  print('Part name: ${part.getName()}, size: ${part.getSize()} bytes');
}
</code></pre>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">@protected
Future&lt;List&lt;Part&gt;&gt; parse(InputStream inputStream, String boundary, String charset, [int? contentLength]) async {
  final parts = &lt;Part&gt;[];
  final logger = getLog();

  final encodingDecoder = getEncodingDecoder();
  final boundaryBytes = encodingDecoder.encode(&#39;--$boundary&#39;, encodingString: charset);

  try {
    &#47;&#47; Read data in chunks using the buffer size
    final allData = await _readAllData(inputStream, contentLength);

    if (logger.getIsTraceEnabled()) {
      logger.trace(&quot;Read ${allData.length} bytes from input stream&quot;);
    }
    var position = 0;

    &#47;&#47; Find the first boundary
    position = _findBoundary(allData, boundaryBytes, position);

    if (logger.getIsTraceEnabled()) {
      logger.trace(&quot;First boundary at position: $position (boundary length ${boundaryBytes.length})&quot;);
    }

    if (position == -1) {
      throw MultipartParseException(&#39;No boundary found in multipart data&#39;);
    }

    position += boundaryBytes.length;

    while (position &lt; allData.length) {
      &#47;&#47; Skip CRLF after boundary
      if (position + 1 &lt; allData.length &amp;&amp; allData[position] == 13 &amp;&amp; allData[position + 1] == 10) {
        position += 2;
      }

      &#47;&#47; Find the end of headers
      final headersEnd = _findSequence(allData, encodingDecoder.encode(CRLFCRLF, encodingString: charset), position);

      if (logger.getIsTraceEnabled()) {
        logger.trace(&quot;HeadersEnd at $headersEnd (search pos $position)&quot;);
      }

      if (headersEnd == -1) {
        break;
      }

      &#47;&#47; Parse headers
      final headersData = allData.sublist(position, headersEnd);
      final headersString = encodingDecoder.decode(headersData, encodingString: charset);
      final headers = _parseHeaders(headersString);

      position = headersEnd + 4; &#47;&#47; Skip CRLFCRLF

      &#47;&#47; Find the next boundary
      final nextBoundaryPos = _findBoundary(allData, boundaryBytes, position);

      if (logger.getIsTraceEnabled()) {
        logger.trace(&quot;NextBoundaryPos = $nextBoundaryPos (part data start $position)&quot;);
      }

      if (nextBoundaryPos == -1) {
        break;
      }

      &#47;&#47; Extract part data (excluding the CRLF before boundary)
      var partDataEnd = nextBoundaryPos;
      if (partDataEnd &gt;= 2 &amp;&amp; allData[partDataEnd - 2] == 13 &amp;&amp; allData[partDataEnd - 1] == 10) {
        partDataEnd -= 2;
      }

      final partData = allData.sublist(position, partDataEnd);

      &#47;&#47; Create part
      parts.add(IoPart(headers, partData, encodingDecoder));

      position = nextBoundaryPos + boundaryBytes.length;

      &#47;&#47; Check if this is the end boundary
      if (position + 1 &lt; allData.length &amp;&amp; allData[position] == 45 &amp;&amp; allData[position + 1] == 45) {
        break; &#47;&#47; End boundary found
      }
    }

    return parts;
  } catch (e) {
    throw MultipartParseException(&#39;Failed to parse multipart data: $e&#39;);
  }
}</code></pre>
</section>


  </div> <!-- /.main-content -->
  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>
<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="../../index.html">jetleaf_web</a></li>
    <li><a href="../../jetleaf_web/">jetleaf_web</a></li>
    <li><a href="../../jetleaf_web/MultipartParser-class.html">MultipartParser</a></li>
    <li class="self-crumb">parse method</li>
</ol>

    <h5>MultipartParser class</h5>
    <div id="dartdoc-sidebar-left-content"></div>
  </div><!--/.sidebar-offcanvas-->
  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
</div><!--/.sidebar-offcanvas-->
</main>
<footer>
  <span class="no-break">
    jetleaf_web
      1.0.0
  </span>
  
</footer>


<script src="../../static-assets/highlight.pack.js?v1"></script>
<script src="../../static-assets/docs.dart.js"></script>

</body>
</html>

